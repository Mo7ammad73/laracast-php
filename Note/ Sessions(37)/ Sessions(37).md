## سشن (Session) یعنی چی؟

- سشن به معنای دوره‌ای است که به فعالیت خاصی اختصاص می‌یابد. در وب‌سایت، Session دوره‌ای است که کاربر با سایت شما تعامل می‌کند. هر کاربر Session مخصوص به خودش دارد که با Session های دیگران متفاوت است.
- «سشن» = بازه‌ای از تعامل کاربر با سایت تو.
- هر کاربر سشنِ خودش را دارد، پس داده‌هایش با کاربر دیگر قاطی نمی‌شود.
- **موقتی** است: معمولاً با بستن مرورگر یا بعد از یک بازه‌ی زمانی (وابسته به تنظیمات) پاک می‌شود.
- از دید PHP، با «سوپرگلوبال» `$_SESSION` کار می‌کنی (مثل `$_POST`, `$_GET`)، دقیقاً مثل یک آرایه.
- قبل از دست زدن به `$_SESSION` **باید** سشن را «شروع» کنی: `session_start();`  
  و این کار باید در **اولِ چرخه‌ی درخواست** و **قبل از هر خروجی** انجام شود.
  ✅ جای درست برای پروژه‌ی تو: بالاترین نقطه‌ی ورودی، یعنی `public/index.php`.

#### **گام 1: ایجاد** **Session** **در کنترلر** **index**

ابتدا وارد فایل کنترلر index.php موجود در پوشه controller شده و کد زیر را نوشتیم:
```php
// controller/index.php
<?php
// مثلا وقتی کاربر به صفحه‌ی اصلی می‌آید:
	$_SESSION['name'] = 'Mohammad';  // مثل نوشتن در یک آرایه‌ی معمولی

```

#### **گام 2: خواندن** **Session** **در کنترلر** **about**

برای خواندن  session بالا در هرجایی که خواستیم از آن استفاده کنیم مثلا فایل about.php کد زیر را مینویسیم:
```php
	$name = $_SESSION['name'] ?? 'Guest';  
	var_dump($name);
```
در دستور بالا اگر session مقداردهی نشود مقدار name برابر با GUEST میشود.
####  گام 3: خطای اولیه
با کلیک روی منوی about، خطای زیر را دریافت کردیم:
Warning: Undefined global variable $_SESSION
Warning: Trying to access array offset on value of type null
NULL

#### **گام 4: حل مشکل با** **session_start()**

برای حل این مشکل، در فایل public/index.php کد زیر را اضافه کردیم:

```php
<?php
	session_start(); 
		// بقیه کدها
```


#### **گام 5: نتیجه موفق**

حالا با اجرای مجدد پروژه و کلیک روی about، خروجی زیر را دریافت کردیم:
string(8) "Mohammad"

---

#### **نکات مهم در مورد** **Session** **ها**

**1.** **موقت بودن** **Session** **ها**

- سشن ها **موقت** هستند و برای همیشه ذخیره نمی‌شوند
- با بستن مرورگر معمولاً حذف می‌شوند
- یا بعد از مدت زمان مشخصی (مثل 30 دقیقه یا یک روز) منقضی می‌شوند

**2.دستور session_start()** **ضروری است**

- قبل از کار با $_SESSION، حتماً باید session_start() را فراخوانی کنید
- بهتر است در ابتدای اپلیکیشن (مثل index.php) این کار را انجام دهید

---

## سشن در PHP دو تکه است:

**الف) کوکی در مرورگر**

- نامش معمولاً `PHPSESSID` است.
- فقط یک «شناسه» (ID) است؛ داده‌ی واقعی سشن داخلش نیست.
- هر درخواست بعدی، این کوکی را به سرور می‌فرستد تا سرور بداند «کدام فایلِ سشن» مال این کاربر است.

**ب) فایلِ سشن روی سرور**

- در واقع PHP محتوای `$_SESSION` را در فایلی مثل `sess_abc123...` می‌نویسد.
- مسیر پیش‌فرض در XAMPP ویندوز معمولاً: `C:\xampp\tmp`
- هر بار که `$_SESSION` را تغییر بدهی، آن فایل به‌روزرسانی می‌شود.
  اگر کوکی `PHPSESSID` را پاک کنی:

- درخواست بعدی **بدون** آن شناسه می‌آید → PHP فکر می‌کند این یک کاربرِ تازه است → یک سشن جدید با یک ID جدید می‌سازد → فایل سشن تازه ساخته می‌شود → مقادیر قبلی در دسترس نیستند تا دوباره خودت ستشان کنی.

##  بدست آوردن PHPSESSID

## در مرورگر

بر روی صفحه راست کلیک کرده و گزینه Inspect را میزنیم.
وارد بخش Application میشویم.
در سمت چپ گزینه Cookies را زده و بر روی لینکی که در زیر مجموعه آن هست دابل کلیک میکنیم.
حالا در مقابل PHPSESSID یک value هست که مقدار PHPSESSID این میباشد که در اینجا برابر با tim412g8gf27au6hnr5k03ichn میباشد.

---

## در سرور (XAMPP)

- معمولاً فایل‌های سشن در `C:\xampp\tmp\` با نامی مثل `sess_<session_id>` هستند.
- می‌توانی مسیر را همین‌جا ببینی:
```php
	// مثلا موقت در یک اسکریپت تست:
	echo 'ID: ' . session_id() . PHP_EOL;
	echo 'Save path: ' . session_save_path() . PHP_EOL;
	// کل محتوا:
	var_dump($_SESSION);

```
- اگر `session.save_path` در `php.ini` مقدار داشته باشد، همان مسیر است؛ اگر خالی باشد، PHP از مسیر موقت سیستم استفاده می‌کند.


### این دو بخش چطور با هم کار می‌کنند؟

1. کاربر وارد سایت می‌شود → PHP یک سشن می‌سازد.
- در **مرورگر**: یک کوکی `PHPSESSID=abcd1234` ساخته می‌شود.
- در **سرور**: یک فایل `sess_abcd1234` ساخته می‌شود و مقدارهای `$_SESSION` داخل آن ذخیره می‌شوند.
1. کاربر وقتی دوباره صفحه را باز می‌کند → مرورگر کوکی را به سرور می‌فرستد.
- در واقعPHP می‌گوید: "آهان! این کاربر همون سشن با ID = abcd1234 رو داره"
- بعد می‌رود فایل `sess_abcd1234` را روی سرور باز می‌کند و داده‌ها را برمی‌گرداند داخل `$_SESSION`.

1. اگر کوکی پاک شود → PHP دیگر آن شناسه را دریافت نمی‌کند → فکر می‌کند کاربر جدید است → یک فایل جدید می‌سازد.

---

### 🔹 یک مثال تصویری

فرض کن:

- مرورگر کاربر = کارت عضویت دارد (کوکی، فقط شماره عضویت)
- سرور = دفترچه‌ای دارد که اسم و مشخصات هر عضو را نوشته (فایل سشن)
  📌 وقتی کارت (کوکی) نشان داده می‌شود، سرور می‌رود داخل دفترچه و اطلاعات همان عضو را می‌آورد.  
  📌 اگر کارت گم شود (کوکی پاک شود)، سرور فکر می‌کند تو یک آدم جدیدی هستی و برایت یک کارت و صفحه‌ی خالی جدید می‌سازد.

## مرحله ۱: ساخت یک فایل سشن ساده

یک فایل به اسم `session_test.php` بساز و کد زیر رو داخلش بذار:
```php
<?php session_start();  // یه مقدار داخل سشن ذخیره می‌کنیم 
	if (!isset($_SESSION['name'])) {
		$_SESSION['name'] = "Mohammad";     
		echo "سشن ساخته شد و مقدار ذخیره شد.<br>"; 
	} else {     
		echo "سشن قبلا ساخته شده، مقدار داخلش: " . $_SESSION['name'] . "<br>";
	 }  // نمایش session id echo "Session ID: " . session_id();
```


---

## 🟢 مرحله ۲: اجرا در مرورگر

۱. مرورگرت رو باز کن و برو به آدرس:

```text
http://localhost/session_test.php
```

۲. بار اول اینو می‌بینی:

`سشن ساخته شد و مقدار ذخیره شد. Session ID: abcd1234efgh5678`

۳. بار دوم صفحه رو Refresh کن → اینو می‌بینی:

`سشن قبلا ساخته شده، مقدار داخلش: Mohammad Session ID: abcd1234efgh5678`

📌 دقت کن ID همونه (یعنی مرورگر کوکی فرستاده و PHP سشن قبلی رو شناخته).

---

## 🟢 مرحله ۳: بررسی سمت کلاینت (مرورگر)

۱. روی صفحه راست‌کلیک کن → `Inspect` → تب **Application** یا **Storage**.  
۲. بخش **Cookies** رو باز کن.  
۳. می‌بینی یک کوکی به اسم `PHPSESSID` ذخیره شده (مثلاً: `abcd1234efgh5678`).

👉 این همون بخش **کلاینت**ه که فقط شماره‌ی سشن رو نگه می‌داره.

---

## 🟢 مرحله ۴: بررسی سمت سرور

۱. برو به پوشه‌ی زیر در XAMPP:

`C:\xampp\tmp`

۲. یک فایل به اسم چیزی مثل `sess_abcd1234efgh5678` پیدا می‌کنی.  
۳. این فایل رو با Notepad باز کن → می‌بینی چیزی مثل این نوشته:

`name|s:8:"Mohammad";`

👉 این همون بخش **سرور**ه که کل داده‌های سشن اینجا ذخیره شده.

---

✅ حالا می‌بینی که:

- مرورگر فقط یک **ID** نگه می‌داره (کوکی).
- سرور تمام **اطلاعات اصلی سشن** رو نگه می‌داره (فایل داخل tmp).

---


## کوکی (Cookie) چیه؟

- کوکی یک **فایل کوچیک متنی** هست که مرورگر (Chrome, Firefox و …) روی سیستم کاربر ذخیره می‌کنه.
- داخل کوکی فقط یک سری اطلاعات ساده ذخیره می‌شه (مثلاً: Session ID، زبان انتخابی سایت، نام کاربری ذخیره‌شده و …).
- کوکی توسط مرورگر **به صورت خودکار** همراه هر درخواست (request) به همون سایت فرستاده می‌شه.

---

## 🔹 ارتباط کوکی و سشن

وقتی PHP برای اولین بار سشن رو شروع می‌کنه (`session_start()`):

1. سرور یک **Session ID** می‌سازه (مثلاً `abcd1234efgh5678`).
2. این ID رو داخل یک کوکی به اسم `PHPSESSID` قرار می‌ده و به مرورگر می‌فرسته.  
   (این اتفاق در **HTTP Response Header** میفته).
3. مرورگر این کوکی رو ذخیره می‌کنه.
4. از این به بعد، هر بار که مرورگر درخواستی به همون سرور می‌فرسته، **کوکی `PHPSESSID` رو هم می‌فرسته** (این اتفاق در **HTTP Request Header** میفته).

👉 اینطوری سرور می‌فهمه کدوم فایل سشن رو باز کنه.

---

## 🔹 یک مثال واقعی از کوکی در Header

### 📌 بار اول (وقتی سشن تازه ساخته میشه):

```text
HTTP Response Header (سرور → مرورگر) Set-Cookie: PHPSESSID=abcd1234efgh5678; path=/
```

📌 اینجا مرورگر می‌گه: "باشه، این کوکی رو ذخیره می‌کنم."

---

### 📌 درخواست بعدی (وقتی صفحه رو Refresh می‌کنی):

```text
HTTP Request Header (مرورگر → سرور) Cookie: PHPSESSID=abcd1234efgh5678
```

📌 حالا سرور می‌گه: "آها! این همون کاربر قبلیه، پس فایل `sess_abcd1234efgh5678` رو باز می‌کنم."

---

## 🔹 خلاصه خیلی ساده

- **کوکی = برگه شماره** که توی مرورگر ذخیره شده.
- **سشن = پرونده‌ی اصلی** که روی سرور نگه‌داری میشه.
- مرورگر همیشه اون شماره (کوکی) رو نشون میده تا سرور پرونده‌ی درست رو پیدا کنه.




یه تست خیلی ساده بزنیم تا **کوکی‌ها رو با چشم ببینی**.

---

### 📌 مرحله ۱: یک فایل PHP بساز

مثلاً اسمش رو بذار `cookie_test.php`

```php
<?php session_start();  // یک مقدار تست در سشن ذخیره می‌کنیم 
if (!isset($_SESSION['counter'])) {     
$_SESSION['counter'] = 1; } 
else {     $_SESSION['counter']++; }  
echo "Session Counter: " . $_SESSION['counter'] . "<br>";  // چاپ تمام کوکی‌های مرورگر 
echo "<pre>"; print_r($_COOKIE); 
echo "</pre>";

```
---

### 📌 مرحله ۲: اجرا

1. این فایل رو روی سرور لوکال (یا هاستت) اجرا کن.
2. دفعه اول که صفحه رو باز کنی، مقدار `counter` میشه 1.
3. مرورگر یه کوکی به اسم `PHPSESSID` می‌سازه.
4. دفعه دوم که صفحه رو Refresh کنی:
- مرورگر **کوکی `PHPSESSID`** رو همراه درخواست می‌فرسته.
- سرور فایل سشن قبلی رو باز می‌کنه.
- مقدار `counter` میشه 2.

---

### 📌 نتیجه‌ای که می‌بینی

مثلاً بعد از یک بار رفرش:

`Session Counter: 2  Array (     [PHPSESSID] => abcd1234efgh5678 )`

---

👉 اینطوری می‌فهمی مرورگر **واقعاً کوکی می‌فرسته** و بدون اون، سشن کار نمی‌کنه.
## نکته
اگر به پوشه Xampp/temp بروی و فایل session رو حذف کنی دوباره صفحه رو رفرش کنی باز از یک شروع میشه.
نام فایل کوکی در این مسیر با id سشن ساخته شده.
برای بدست آوردن id سشن کافیست کد زیر را بنویسیم:
```php
echo session_id();
```

### دیدن کوکی سشن در مرورگر (Chrome یا Firefox)

1. همون صفحه `cookie_test.php` رو باز کن.
2. روی صفحه کلیک راست کن → **Inspect** (یا کلید F12 رو بزن).
3. از بالا برو به تب **Application** (یا در فایرفاکس: Storage).
4. در منوی سمت چپ روی **Cookies** کلیک کن و بعد آدرس سایتت رو انتخاب کن.
5. اینجا لیست تمام کوکی‌هایی که مرورگر ذخیره کرده رو می‌بینی.

---

### 📌 چیزی که باید ببینی

یک کوکی به اسم **PHPSESSID** وجود داره.  
مثلاً مقدارش شبیه اینه:
```text
	Name: PHPSESSID
	 Value: abcd1234efgh5678 
	 Domain: localhost 
	 Path: / 
	 Expires: Session
```
🔑 نکته مهم:

- این مقدار (`abcd1234efgh5678`) همون شناسه سشنته.
- مرورگر اینو به صورت اتوماتیک همراه هر درخواست بعدی برای سرور می‌فرسته.
- سرور هم با همین شناسه می‌فهمه که باید فایل سشن کدوم کاربر رو بخونه.

---

**پاک کردن کوکی** تا ببینی سشن چطور از بین میره:

---

### 📌 تست پاک کردن کوکی سشن

1. برو به همون تب **Application → Cookies**.
2. کوکی‌ای که اسمش **PHPSESSID** هست رو انتخاب کن.
3. روش راست‌کلیک کن و **Delete** رو بزن.

---

### 📌 حالا چی میشه؟

- وقتی دوباره صفحه `cookie_test.php` رو رفرش کنی، مرورگر چون دیگه کوکی نداره، برای سرور مثل یک **کاربر جدید** به نظر میاد.
- سرور یک **شناسه سشن جدید** می‌سازه (مثلاً `xyz987654321`) و در یک کوکی جدید به مرورگر می‌فرسته.
- بنابراین `counter` دوباره از **۱** شروع میشه، چون دیگه فایل سشن قبلی پیدا نمیشه.
---

### 📌 نتیجه

- اگر کوکی PHPSESSID وجود داشته باشه → سشن ادامه پیدا می‌کنه.
- اگر کوکی پاک بشه → سشن قبلی گم میشه و یه سشن جدید ساخته میشه.

---

👍 این دقیقاً نشون میده که سشن بدون کوکی کار نمی‌کنه.

1. (مرورگر) ----درخواست صفحه---> (سرور)
2.          [session_start()]
3. (سرور)
   |
   |-- آیا کوکی PHPSESSID موجود است؟
   |
   |--- بله: session مربوط را پیدا می‌کند، داده‌ها را می‌خواند.
   |--- خیر: آیدی جدید می‌سازد، فایل جدید session روی سرور می‌سازد.
   |
   \-- داده‌ای در $_SESSION ذخیره کردی ← داخل فایل سشن ذخیره می‌شود.
4. (سرور) ----پاسخ+کوکی PHPSESSID----> (مرورگر)
5. (مرورگر) برای هر درخواست جدید ← کوکی sessionid را همراه درخواست می‌فرستد.
6. (سرور) طبق sessionid، فایل داده را می‌خواند و داده قبلی را بازیابی می‌کند.
