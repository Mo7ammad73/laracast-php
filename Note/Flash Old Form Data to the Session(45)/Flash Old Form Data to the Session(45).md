یک نکته قبل از شروع این جلسه بگم واون اینه وقتی صفحه log in یا هرصفحه دیگه ای که فرم داره به صورت پیش فرض فیلدهای جعبه متنش ممکن با اطلاعاتی پر بشه تگ input  در html صفت autocomplete داره اگر مثلا مقدارش email باشه میاد یه ایمیل پیش فرض مرورگر رو داخلش ذخیره میکنه پس باید مقدار اونو عوض کنیم مثلا new-email که هیچ جایی نیست همین صفت رو برای تگ input مربوط به پسوورد هم عوض میکنیم حالا تو بخش value مربوط به این تگ ها اگر کدی مثل
```php
value=<? $_POST['email'] ?? ' '; ?>
```
درست کارمیکند ضمنا اگر این صفت را off کنیم مقدارش را دیگر ایمیل های پیشنهادی نمایش داده نمیشود.

---
# جلسه 45
## 🔹 مشکل اولیه

قبلاً اگر فرم لاگین رو با داده‌ی اشتباه پر می‌کردیم:
- بعد از submit → ریدایرکت می‌شدیم به صفحه لاگین.
- خطاهای validation درست نشون داده می‌شدن.
- **اما داده‌های فرم (مثلاً ایمیل)** دوباره خالی بودن! ❌

چرا؟  
چون ما دیگه توی سیستم جدیدمون از الگوی **Post-Redirect-Get (PRG)** استفاده می‌کنیم.  
وقتی `POST` می‌زنیم و بعد `redirect` می‌کنیم، `$_POST` دیگه در صفحه مقصد در دسترس نیست.

---
## 🔹 یادآوری از سیستم قدیم

قبلاً مستقیماً بعد از `POST` همون view رو رندر می‌کردیم. بنابراین:
```php
value=" <?= $_POST['email'] ?? '' ?> "
```
کار می‌کرد، چون `$_POST` هنوز وجود داشت.  
ولی الان دیگه بعد از redirect هیچ `$_POST`ای نداریم.

---
## 🔹 راه‌حل: Flash old data

مثل خطاها که با **session flash** ذخیره کردیم، حالا داده‌های قدیمی فرم (old form data) رو هم flash می‌کنیم.
### 1) ذخیره در کنترلر
درفایل store.php :
```php
// وقتی login fail شد:
Session::flash('old', [
    'email' => $_POST['email']
]);
// redirect back
return Redirect("/laracast-php/public/login");
```
✍️ فقط ایمیل رو ذخیره می‌کنیم، چون پسورد **هرگز نباید دوباره پر بشه**.

---
### 2) گرفتن در view

در create.view.php` باید داده‌ی ذخیره‌شده رو بخونیم:
```php
<input type="email" name="email"
       value="<?= $_SESSION['_flash']['old']['email'] ?? '' ?>">
```
ولی اینجوری بدخط میشه.

---
### 3) استفاده از متد `get` در Session
ما قبلاً یه متد `get` توی `Session` ساخته بودیم که راحت‌تر فلش رو می‌خونه. پس می‌نویسیم:
```php
value="<?= Core\Session::get('old')['email'] ?? '' ?>"
```
---
### 4) بهتر کردن با helper function

هنوز کد طولانیه. پس میایم توی `functions.php` یه helper به اسم `old()` می‌نویسیم:
```php
function old($key , $default =''){  
    return core\session::get('old')[$key] ?? $default;  
}
```
---
### 5) استفاده ساده در view
حالا توی فرم خیلی راحت می‌نویسیم:
```php
<input id="email" type="email" name="email" required autocomplete="new-email" 
value="<?= old('email') ?? ' '; ?>"
```
---
### 6) قابلیت default سفارشی
این helper حتی اجازه می‌ده مقدار پیش‌فرض دلخواه هم بدی:
```php
value="<?= old('email', $user->email) ?>"
```
یعنی اگر ایمیل قدیمی وجود نداشت، از ایمیل کاربر لاگین‌شده استفاده کن.

---
## 🔹 نتیجه
- اگر کاربر فرم رو پر کنه و خطا بشه → بعد از redirect ایمیلش دوباره توی فیلد هست ✅
- پسورد همیشه خالی می‌مونه ✅
- کد تمیز و کوتاه شده ✅
  🎯 پس مهم‌ترین نکته‌ی این جلسه اینه که با سیستم **PRG** دیگه نمی‌تونی از `$_POST` مستقیم استفاده کنی.  
  باید داده‌های قدیمی فرم رو هم مثل خطاها **فلش** کنی توی سشن، بعد با یک helper (مثل `old()`) دوباره توی view نمایش بدی.